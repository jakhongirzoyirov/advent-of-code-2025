package org.example.day7;

import java.math.BigInteger;
import java.util.*;

public class Main {
    static class Beam {
        int r, c;
        Beam(int r, int c) {
            this.r = r;
            this.c = c;
        }
        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (!(o instanceof Beam)) return false;
            Beam beam = (Beam) o;
            return r == beam.r && c == beam.c;
        }

        @Override
        public int hashCode() {
            return Objects.hash(r, c);
        }

        @Override
        public String toString() {
            return "(" + r + ", " + c + ")";
        }
    }

    public static void main(String[] args) {
        String[] split = getInput().split("\n");
        List<String> input = new ArrayList<>();
        for (int i = 0; i < split.length; i++) {
            input.add(split[i]);
        }
        System.out.println(day2(input));
    }

    private static BigInteger day2(List<String> grid) {
        int R = grid.size();
        int C = grid.get(0).length();

        BigInteger[][] dp = new BigInteger[R + 1][C];
        for (int r = 0; r <= R; r++)
            for (int c = 0; c < C; c++)
                dp[r][c] = BigInteger.ZERO;

        int sR = -1, sC = -1;
        outer:
        for (int r = 0; r < R; r++)
            for (int c = 0; c < C; c++)
                if (grid.get(r).charAt(c) == 'S') { sR = r; sC = c; break outer; }

        dp[sR + 1][sC] = BigInteger.ONE;

        for (int r = sR + 1; r < R; r++) {
            for (int c = 0; c < C; c++) {

                if (dp[r][c].equals(BigInteger.ZERO)) continue;

                char cell = grid.get(r).charAt(c);

                if (cell == '^') {
                    if (c - 1 >= 0)
                        dp[r + 1][c - 1] = dp[r + 1][c - 1].add(dp[r][c]);

                    if (c + 1 < C)
                        dp[r + 1][c + 1] = dp[r + 1][c + 1].add(dp[r][c]);

                } else {
                    dp[r + 1][c] = dp[r + 1][c].add(dp[r][c]);
                }
            }
        }

        BigInteger total = BigInteger.ZERO;
        for (int c = 0; c < C; c++)
            total = total.add(dp[R][c]);

        return total;
    }

    private static int day1(List<String> grid) {
        Set<Beam> set = new HashSet<>();
        int R = grid.size();
        int C = grid.get(0).length();

        int startR = 0, startC = 0;
        outer:
        for (int r = 0; r < R; r++) {
            for (int c = 0; c < C; c++) {
                if (grid.get(r).charAt(c) == 'S') {
                    startR = r;
                    startC = c;
                    break outer;
                }
            }
        }

        Queue<Beam> q = new ArrayDeque<>();
        q.add(new Beam(startR + 1, startC));

        int splits = 0;

        while (!q.isEmpty()) {
            Beam b = q.poll();
            int r = b.r;
            int c = b.c;

            if (r < 0 || r >= R || c < 0 || c >= C) continue;

            char cell = grid.get(r).charAt(c);

            if (cell == '^') {
                if (!set.contains(b)) {
                    splits++;
                }

                set.add(b);

                q.add(new Beam(r + 1, c - 1));

                q.add(new Beam(r + 1, c + 1));

                continue;
            }

            if (!q.contains(new Beam(r+1, c))) q.add(new Beam(r + 1, c));
        }

        return splits;
    }

    private static String getExample() {
        return ".......S.......\n" +
                "...............\n" +
                ".......^.......\n" +
                "...............\n" +
                "......^.^......\n" +
                "...............\n" +
                ".....^.^.^.....\n" +
                "...............\n" +
                "....^.^...^....\n" +
                "...............\n" +
                "...^.^...^.^...\n" +
                "...............\n" +
                "..^...^.....^..\n" +
                "...............\n" +
                ".^.^.^.^.^...^.\n" +
                "...............";
    }

    private static String getInput() {
        return "......................................................................S......................................................................\n" +
                ".............................................................................................................................................\n" +
                "......................................................................^......................................................................\n" +
                ".............................................................................................................................................\n" +
                ".....................................................................^.^.....................................................................\n" +
                ".............................................................................................................................................\n" +
                "....................................................................^.^.^....................................................................\n" +
                ".............................................................................................................................................\n" +
                "...................................................................^.^.^.^...................................................................\n" +
                ".............................................................................................................................................\n" +
                "..................................................................^.....^.^..................................................................\n" +
                ".............................................................................................................................................\n" +
                ".................................................................^.^.^.....^.................................................................\n" +
                ".............................................................................................................................................\n" +
                "................................................................^...^.^.^.^.^................................................................\n" +
                ".............................................................................................................................................\n" +
                "...............................................................^.^.^.^.^...^.^...............................................................\n" +
                ".............................................................................................................................................\n" +
                "..............................................................^.^.^.^.^.....^.^..............................................................\n" +
                ".............................................................................................................................................\n" +
                ".............................................................^...^.^.^...^.....^.............................................................\n" +
                ".............................................................................................................................................\n" +
                "............................................................^...^.^.....^.^...^.^............................................................\n" +
                ".............................................................................................................................................\n" +
                "...........................................................^...^.^.......^.^.....^...........................................................\n" +
                ".............................................................................................................................................\n" +
                "..........................................................^.^.^...^.^...^...^.....^..........................................................\n" +
                ".............................................................................................................................................\n" +
                ".........................................................^.^.^.^...^.......^...^.^.^.........................................................\n" +
                ".............................................................................................................................................\n" +
                "........................................................^.^.^.^.^...^.^.^.^.^.^...^.^........................................................\n" +
                ".............................................................................................................................................\n" +
                ".......................................................^.^.^.^...^.^.^.^.^.^.^.......^.......................................................\n" +
                ".............................................................................................................................................\n" +
                "......................................................^.....^.^...^.^.^.^...^...^.^.^.^......................................................\n" +
                ".............................................................................................................................................\n" +
                ".....................................................^.^.^...^.^.^.^.^.....^...^.^.^.^.^.....................................................\n" +
                ".............................................................................................................................................\n" +
                "....................................................^.....^.^.^.^.^.^...^.^.^.....^.....^....................................................\n" +
                ".............................................................................................................................................\n" +
                "...................................................^.....^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...................................................\n" +
                ".............................................................................................................................................\n" +
                "..................................................^.^.....^...^...^.^...^.^.^.^.^.^.^.....^..................................................\n" +
                ".............................................................................................................................................\n" +
                ".................................................^.^.^.^...^.......^.^.^.^.^...^.^.^.^.^...^.................................................\n" +
                ".............................................................................................................................................\n" +
                "................................................^.^...^.^...^...^.^...^.^.^.^.^.^.^.^.^...^.^................................................\n" +
                ".............................................................................................................................................\n" +
                "...............................................^...^...^...^.....^.^.^.^.^.^.....^...^.^.^.^.^...............................................\n" +
                ".............................................................................................................................................\n" +
                "..............................................^...^.^.....^.^.^.....^.^.^...^.^...^.^.^...^.^.^..............................................\n" +
                ".............................................................................................................................................\n" +
                ".............................................^.^.^.^...^...^.^.^...^.^.^...^.^.....^...^.^...^.^.............................................\n" +
                ".............................................................................................................................................\n" +
                "............................................^.^.^.^.^.^.^.^.^.....^.^.....^.^.^...^...^.^.^...^.^............................................\n" +
                ".............................................................................................................................................\n" +
                "...........................................^.^.^.^.^.^.^...^.^.^.^...^.......^.^...........^.^.^.^...........................................\n" +
                ".............................................................................................................................................\n" +
                "..........................................^.^...^.^.^.^.^.^.^.^.^...^.^.^.^.....^.^.^.^.^.........^..........................................\n" +
                ".............................................................................................................................................\n" +
                ".........................................^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.........................................\n" +
                ".............................................................................................................................................\n" +
                "........................................^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^...^.^.^.^.^.^.^...^.^........................................\n" +
                ".............................................................................................................................................\n" +
                ".......................................^.^.......^...^...^.^.^.^...^...^.^.^...^...^...^...^...^.^.^.^.......................................\n" +
                ".............................................................................................................................................\n" +
                "......................................^.......^...^.^.^.^.^...^...^.^.^.^...^.^.^.^...^.^.^...^.^.^...^......................................\n" +
                ".............................................................................................................................................\n" +
                ".....................................^.^.^.^.^.^.^.^.^...^.^...^...^.^.^.^.^...^.^.....^.^.^.^.^.^.^.^.^.....................................\n" +
                ".............................................................................................................................................\n" +
                "....................................^.^.^...^.^...^.^...^.....^...^.^...^.^.^.......^.^...^.....^.^.^.^.^....................................\n" +
                ".............................................................................................................................................\n" +
                "...................................^.^.^.^...^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.....^.^.^.^.^.^...................................\n" +
                ".............................................................................................................................................\n" +
                "..................................^.^.^.^.^.^.^...........^.^.^.^.^...^...^...^.^.^.^.^.^.^...^.^.^...^...^..................................\n" +
                ".............................................................................................................................................\n" +
                ".................................^.^.^.^.^.^.^.^.^.....^.^...^.^.....^.^...^.^.^.^.^.....^.^.....^.^.^.....^.................................\n" +
                ".............................................................................................................................................\n" +
                "................................^...^.^.^.^.......^.^.^...^...^.^.^.^...^...^.^.....^.....^.^.^...^.^.....^.^................................\n" +
                ".............................................................................................................................................\n" +
                "...............................^...^.^...^.......^...^.^.^.^.^.^...^...^.^.^...^...^.^.^.^.^.^.^.^.....^.^.^.^...............................\n" +
                ".............................................................................................................................................\n" +
                "..............................^.^.^...^.^...^.^.^.^.^.^.^...^.^.^.^.^...^...^.....^...^.^.........^.....^...^.^..............................\n" +
                ".............................................................................................................................................\n" +
                ".............................^...^.^...^.....^.^.^.^.......^.^...^.^.^.^.^...^.^...^.^.^.^.^...^.^.^.^.^.^.....^.............................\n" +
                ".............................................................................................................................................\n" +
                "............................^.^.^.......^.....^...^.^.^.^.^.......^.^.^.^.....^.^.^.^...^...^.^.^...^...^.^.^.^.^............................\n" +
                ".............................................................................................................................................\n" +
                "...........................^.......^...^.^.^.^...^...^.^.^...^.^.^...^.^.....^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^...........................\n" +
                ".............................................................................................................................................\n" +
                "..........................^.^.^.^.^.^.^.....^.^...^.^...^.^.^.^.^...^...^.^...^.^.^.^.^.....^.^.^...^.^...^...^.^.^..........................\n" +
                ".............................................................................................................................................\n" +
                ".........................^.^.^.^.^.^.^.^.......^...^.^.^...^.^.^.^...^.^.....^...^.^.^.^.^.^...^.^...^.^.^.^.^.^...^.........................\n" +
                ".............................................................................................................................................\n" +
                "........................^.^...^.......^.^.....^.....^.^.^.^.^...^.^.^.^.......^.^.^.^.^...^.^.^.^.^.....^.^.^.^...^.^........................\n" +
                ".............................................................................................................................................\n" +
                ".......................^.^.^.^...^...^.......^.....^...^.^.^.^.....^...^...^...^.^.^.........^.^.^...^.^.^.^.^.^.....^.......................\n" +
                ".............................................................................................................................................\n" +
                "......................^.^...^.^.^.^.^.^.^...^...^.^...^...^.^.^...^...^.^.^...^.....^...^.^.^.^.^...^.^...^.^...^.^.^.^......................\n" +
                ".............................................................................................................................................\n" +
                ".....................^.^.^...^.^.^.^.^.^.^.^...^...^.....^...^.^.^.....^.^.^...^...^.^.^.^...^.....^.^...^.^.^.^...^.^.^.....................\n" +
                ".............................................................................................................................................\n" +
                "....................^.^.....^.^.^.^.^.^.^...^.^.^.^...^...^.^...^...^.^.^.^.^.^...^...^.^...^.....^.^.^...^.^.^.........^....................\n" +
                ".............................................................................................................................................\n" +
                "...................^.^.^.^.^...^.^...^.^.......^.^...^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.......^...^.^.^...^.^.......^.^.^...................\n" +
                ".............................................................................................................................................\n" +
                "..................^.^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^...^.^.....^.^.^.^...^.^.^.^.^.^.^.^...^.^.....^..................\n" +
                ".............................................................................................................................................\n" +
                ".................^.^.^.^.^.^.^.^.^...^...^.^.....^.^...^.......^.^.^.^.^.^.^...^.....^.....^.^.^.^...^.^.^.^.^.^.^.....^.^.^.................\n" +
                ".............................................................................................................................................\n" +
                "................^.^.^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^.^.^.^.^.....^.......^.^.^.....^...^...^.^.....^.^.^...^.^.^.^.^.....^................\n" +
                ".............................................................................................................................................\n" +
                "...............^.^.^.^...^.^.^.^...^.^...^.^.........^.^.^...^.^...^.....^.^.....^.^.^.^...^.^.^.^.......^.^.^.^.^.^.^.^.^...^...............\n" +
                ".............................................................................................................................................\n" +
                "..............^.^.^.......^.^.^.^.^.^...^.^.^.^.......^.^.......^.......^.^.^...^.^.....^.^.^.^.^.^...^...^.....^.^.^...^.^.^.^..............\n" +
                ".............................................................................................................................................\n" +
                ".............^...^.^...^.^.^.^...^.^.^...^.^.....^.^.^...^.^.....^.^.^.^.^...^...^.^.^.^.^...^...^.^.^.^...^.^.....^.^.^...^.^.^.............\n" +
                ".............................................................................................................................................\n" +
                "............^.^.......^.^.^.^.^.^.^.^...^.^.....^.^.^.^.^.^.^.....^...^.^.^.^.....^.^.^.^.^...^...^.^.^.^.^...^.^.....^.^.^...^.^............\n" +
                ".............................................................................................................................................\n" +
                "...........^.^...^.^.^.^.........^.^.^.^...^.^.^.^.....^.^...^.^...^.^.......^...^.....^.^.^.^.^.^.^.^.^.^.^.^.^...^.....^.^.^.^.^...........\n" +
                ".............................................................................................................................................\n" +
                "..........^.....^.^.^.^...^.......^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^...^.^...^.........^.^.......^.^.....^.^...^.......^..........\n" +
                ".............................................................................................................................................\n" +
                ".........^.....^.^...^.....^.^...^...^.^.^.^.^.^.^.^...^.....^.^.^.....^.^.....^.^.^...^.^.^.^.^.........^.^.....^.^.^.^...^.^.^...^.........\n" +
                ".............................................................................................................................................\n" +
                "........^.^...^.....^...^.^.^...^.^...^.^.^.^...^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^...^...^...^.^.....^.^.^.^.........^...^.^.^...^........\n" +
                ".............................................................................................................................................\n" +
                ".......^...^.^...^.^.^.^.^.^.^.^...^.^.....^.^.^.^.^.^.^...^.^.^.............^...^.^.^.^.^.^.^.^...^...^.^.^.^.........^...........^.^.......\n" +
                ".............................................................................................................................................\n" +
                "......^.^.^...^...^...^.....^.^.^...^.....^.^...^.^.^.^.^.^.....^.^.^.^...^.^...^.^.^.^...^.....^.^.^.^.^.^.^.^.........^...^...^.^.^.^......\n" +
                ".............................................................................................................................................\n" +
                ".....^.^.^.^.....^.^.....^.^...^.^...^...^.^.^.^...^.^.^.^.^.......^.^...^.^...^...^.^.^.^...^.^...^...^...^...^.^.........^.^.^.^.^.^.^.....\n" +
                ".............................................................................................................................................\n" +
                "....^.^.^...^.^...^.^.....^.^.^.^...^.^.^.....^.^...^.^.^.^.^.^.^...^.....^.....^.^.^...^.^.^.^.^.....^.^.^.^.^...^.^.^.^.^.^.^.^...^.^.^....\n" +
                ".............................................................................................................................................\n" +
                "...^.^.^.^...^.^.^.^.^.^.^.....^.^.......^.^.^...^.^.^...^.....^.^.......^.^.^.^.^.....^...^.^.^...^...^.........^.^.^.^.^...^.^.^.......^...\n" +
                ".............................................................................................................................................\n" +
                "..^.^...^...^.^.^.^.^...^...^.^.^.^.^...^...^.^...^.^.^.^.^...^.^.^.^...^.^...^.^.^...^.^.^.^...^...^.^.^.^.^.....^...^.^.^.^.^.^.^.^.^.^.^..\n" +
                ".............................................................................................................................................\n" +
                ".^.^.^.....^.^...^.^.^.....^.^.^...^.....^.^.^.^.^.^.^.^.^...^.^.^.^.^.....^.^.^.....^.^.......^...^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.\n" +
                ".............................................................................................................................................";
    }
}
